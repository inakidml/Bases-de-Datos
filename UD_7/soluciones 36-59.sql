
/* Ejemplo aplicación 36*/
SELECT dept_no,OFICIO, COUNT(*) "Numero_empleados"
FROM EMPLE 
GROUP BY OFICIO, dept_no;




/* Ejemplo aplicación 37*/

SELECT MAX(COUNT(*))  "Número máximo de empleados"
FROM EMPLE
GROUP BY DEPT_NO;


/* Ejemplo aplicación 38*/

SELECT E.DEPT_NO, DNOMBRE,OFICIO, COUNT(*) "NÚMERO DE EMPLEADOS"
FROM EMPLE E, DEPART D
WHERE E.DEPT_NO=D.DEPT_NO
GROUP BY E.DEPT_NO, DNOMBRE,OFICIO;


/* Ejemplo aplicación 39*/

SELECT DEPT_NO, ROUND(AVG(SALARIO),0) AS "Salario medio"
FROM EMPLE 
GROUP BY DEPT_NO
HAVING MAX(SALARIO)>250000;

/* Ejemplo aplicación 40*/

SELECT MAX(ROUND(AVG(SALARIO),0)) 
FROM EMPLE 
GROUP BY DEPT_NO;

/* Ejemplo aplicación 41*/

SELECT OFICIO, COUNT(*) Numero_empleados
FROM EMPLE 
GROUP BY OFICIO;

/* Ejemplo aplicación 42*/

SELECT DIR, MIN(SALARIO) 
FROM EMPLE 
WHERE DIR IS NOT NULL
GROUP BY DIR
HAVING MIN(SALARIO)>200000
ORDER BY MIN(SALARIO) DESC;



/* Ejemplo aplicación 43*/

SELECT DNOMBRE AS "Nombre_depto", LOC AS "Localidad",
COUNT(*) AS "Nº empleados", 
ROUND(AVG(SALARIO),2) AS "Media salarial"
FROM EMPLE E, DEPART D
WHERE E.DEPT_NO=D.DEPT_NO
GROUP BY DNOMBRE, LOC;

/* Ejemplo aplicación 44*/

SELECT  COUNT(*)
FROM EMPLE E, DEPART D
WHERE DNOMBRE='VENTAS' AND OFICIO='VENDEDOR'
AND E.DEPT_NO=D.DEPT_NO;

/* Ejemplo aplicación 45*/

SELECT OFICIO, SUM(SALARIO)
FROM EMPLE E,DEPART D
WHERE E.DEPT_NO=D.DEPT_NO AND DNOMBRE='VENTAS' 
GROUP BY OFICIO;



/* Ejemplo aplicación 46*/

SELECT DEPT_NO,COUNT(*) "Nº DE EMPLEADOS"
FROM EMPLE
WHERE OFICIO ='EMPLEADO'
GROUP BY DEPT_NO;

SELECT E.DEPT_NO,DNOMBRE,COUNT(*) "Nº DE EMPLEADOS"
FROM EMPLE E, DEPART D
WHERE OFICIO ='EMPLEADO' 
AND D.DEPT_NO=E.DEPT_NO
GROUP BY E.DEPT_NO, DNOMBRE;


SELECT D.DEPT_NO,DNOMBRE, COUNT(*) "Nº DE EMPLEADOS"
FROM EMPLE E, DEPART D 
WHERE D.DEPT_NO=E.DEPT_NO
GROUP BY D.DEPT_NO, D.DNOMBRE, E.OFICIO
HAVING OFICIO='EMPLEADO'


/* Ejemplo aplicación 47*/

SELECT DEPT_NO,OFICIO,COUNT(*) 
FROM EMPLE 
GROUP BY DEPT_NO, OFICIO  
HAVING COUNT(*) >2;


/* Ejemplo aplicación 48*/

SELECT APELLIDO, OFICIO
FROM EMPLE
WHERE OFICIO =(SELECT OFICIO
	            FROM EMPLE
                WHERE APELLIDO='GIL')
AND APELlIDO<>'GIL';   


/* Ejemplo aplicación 49 */
SELECT EMP_NO, APELLIDO
FROM   EMPLE
WHERE  SALARIO = ( SELECT MIN(SALARIO)
			   FROM EMPLE
			   GROUP BY DEPT_NO);
			   
/*ERROR en línea 3:
ORA-01427: la subconsulta de una sola fila 
devuelve más de una fila */			  


/* Ejemplo aplicación 50*/

SELECT APELLIDO, OFICIO
FROM   EMPLE
WHERE  OFICIO = ( SELECT OFICIO
			  FROM EMPLE
			  WHERE APELLIDO = 'PEREZ');

* ninguna fila seleccionada */
/*  Si existiera un oficio con valor nulo, 
la fila no se devolvería porque la comparación de
dos valores nulos origina un valor nulo, 
por lo tanto la condición WHERE no es verdadera */


			  
/* Ejemplo aplicación 51*/

SELECT APELLIDO, DEPT_NO, SALARIO
FROM   EMPLE 
WHERE  (SALARIO, DEPT_NO) IN ( SELECT SALARIO, DEPT_NO
							   FROM EMPLE 
							   WHERE COMISION IS NOT NULL);	

							   
SELECT APELLIDO, DEPT_NO, SALARIO
FROM   EMPLE 
WHERE  SALARIO in (SELECT SALARIO
							   FROM EMPLE 
							   WHERE COMISION IS NOT NULL)
							   
AND DEPT_NO IN ( SELECT DEPT_NO
				FROM EMPLE 
				WHERE COMISION IS NOT NULL);					   
							   
							  						   
							   
							   
/* Ejemplo aplicación 52*/

SELECT APELLIDO, DNOMBRE, SALARIO, COMISION
FROM   EMPLE E, DEPART D
WHERE  E.DEPT_NO = D.DEPT_NO 
AND    (SALARIO, COMISION) IN (SELECT SALARIO, COMISION
							   FROM EMPLE E, DEPART D
							   WHERE E.DEPT_NO = D.DEPT_NO
							   AND LOC='BARCELONA');
							   
							   
SELECT APELLIDO, DNOMBRE, SALARIO, COMISION
FROM   EMPLE E, DEPART D
WHERE  E.DEPT_NO = D.DEPT_NO 
AND    (SALARIO, COMISION) IN (SELECT SALARIO, COMISION
							   FROM EMPLE 
							   WHERE DEPT_NO in (select DEPT_NO from depart
							   where LOC='BARCELONA'));


/* Ejemplo aplicación 53*/

SELECT EMP_NO,APELLIDO, DEPT_NO
FROM   EMPLE 
WHERE  DEPT_NO IN (SELECT DEPT_NO
				   FROM DEPART
				   WHERE LOC LIKE '%A');
				   
SELECT EMP_NO,APELLIDO, DEPT_NO
FROM   EMPLE e, depart d
where  E.DEPT_NO = D.DEPT_NO and loc like '%A';

/* Ejemplo aplicación 54*/

SELECT APELLIDO, SALARIO
FROM   EMPLE 
WHERE  SALARIO > (SELECT MAX(SALARIO)
				  FROM EMPLE
				  WHERE OFICIO='DIRECTOR')
ORDER BY SALARIO DESC;	


/* Ejemplo aplicación 55*/

SELECT E.APELLIDO, E.SALARIO, E.DEPT_NO, TRUNC(AVG(A.SALARIO),0) AS MEDIA_DPTO
FROM   EMPLE E, EMPLE A
WHERE E.DEPT_NO = A.DEPT_NO
AND  E.SALARIO>(SELECT AVG(SALARIO)
			    FROM EMPLE A
			    WHERE A.DEPT_NO= E.DEPT_NO)
GROUP BY E.APELLIDO, E.SALARIO, E.DEPT_NO
ORDER BY AVG(A.SALARIO);

SELECT APELLIDO, SALARIO, P.DEPT_NO, S.SALMEDIO 
FROM EMPLE P, (SELECT DEPT_NO, AVG(SALARIO) SALMEDIO FROM EMPLE GROUP BY DEPT_NO) S
WHERE P.DEPT_NO = S.DEPT_NO
AND P.SALARIO > S.SALMEDIO
ORDER BY AVG(S.SALMEDIO);

/* Ejemplo aplicación 56*/

SELECT APELLIDO, SALARIO
FROM   EMPLE 
WHERE  SALARIO> ALL (SELECT SALARIO
					 FROM EMPLE
					 WHERE OFICIO='DIRECTOR')
ORDER BY SALARIO DESC;



/* Ejemplo aplicación 57*/
SELECT APELLIDO
FROM   EMPLE E
WHERE NOT EXISTS (SELECT *
			      FROM EMPLE S
			      WHERE E.EMP_NO= S.DIR);
				  
				  

SELECT APELLIDO
FROM   EMPLE 
WHERE  EMP_NO NOT IN (SELECT DISTINCT DIR 
			          FROM EMPLE 
					  WHERE DIR IS NOT NULL);	

/* Ejemplo aplicación 58*/

SELECT LEVEL, APELLIDO
FROM   EMPLE
WHERE APELLIDO <> 'JIMENO'
START WITH APELLIDO= 'JIMENO'
CONNECT BY PRIOR DIR=EMP_NO;

/* Ejemplo aplicación 59*/


SELECT DEPT_NO
FROM DEPART
MINUS
SELECT DEPT_NO
FROM EMPLE
WHERE OFICIO='ANALISTA';	





